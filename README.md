# Microblog Backend

Backend‑сервис корпоративного микроблога (аналог Twitter), реализованный
в рамках дипломной работы по курсу **Python Advanced**.

Проект полностью соответствует техническому заданию: реализованы все
требуемые API, документация Swagger, Docker‑развёртывание, тесты и
README.

------------------------------------------------------------------------

## Назначение проекта

Сервис предназначен для внутреннего корпоративного использования и
позволяет пользователям:

-   публиковать твиты;
-   удалять свои твиты;
-   ставить и убирать лайки;
-   подписываться и отписываться от других пользователей;
-   получать персональную ленту твитов;
-   прикреплять изображения к твитам.

Регистрация и аутентификация пользователей **не реализуются** ---
пользователь идентифицируется по `api-key`, передаваемому в
HTTP‑заголовках.

------------------------------------------------------------------------

## Функциональные возможности

✔ Создание твитов\
✔ Удаление собственных твитов\
✔ Загрузка изображений\
✔ Лайки и снятие лайков\
✔ Подписки и отписки\
✔ Лента твитов от подписок, отсортированная по популярности\
✔ Получение профиля пользователя и своего профиля\
✔ Авторизация через API‑ключ\
✔ Swagger‑документация всех эндпоинтов

------------------------------------------------------------------------

## Используемые технологии

-   Python 3.10\
-   Flask\
-   Flask‑RESTX (Swagger / OpenAPI)\
-   SQLAlchemy\
-   PostgreSQL\
-   Docker / Docker Compose\
-   Gunicorn\
-   Nginx\
-   Pytest\
-   black / isort / flake8 / mypy

------------------------------------------------------------------------

## Архитектура проекта

Проект состоит из трёх сервисов:

| Сервис   | Назначение           |
|----------|----------------------|
| frontend | Nginx + готовый UI   |
| backend  | Flask API + Gunicorn |
| db       | PostgreSQL           |

Используются Docker volumes --- данные базы и загруженные файлы
сохраняются между перезапусками.

------------------------------------------------------------------------

## Окружения (dev / prod)

Проект поддерживает два режима работы: **dev** и **prod**.
Режим выбирается через переменную окружения `ENVIRONMENT`.

Для выбора режима работы и настройки приложения перед запуском
необходимо создать файл `.env` на основе `.env.example`
и указать нужные значения переменных окружения.

- В режиме **dev** включены `DEBUG`, логирование SQL-запросов и используются
  dev-зависимости (linters, pytest).
- В режиме **prod** приложение запускается через **Gunicorn** с
  production-настройками без отладочных инструментов.

Это позволяет использовать одно и то же приложение как для локальной
разработки, так и для production-развёртывания.

------------------------------------------------------------------------

## Запуск проекта

### Требования

-   Docker\
-   Docker Compose

### Запуск

``` bash
docker-compose up -d
```

После запуска доступны:

- Frontend: http://localhost\
- Swagger API: http://localhost:8000/docs\
- PostgreSQL: localhost:5432

------------------------------------------------------------------------

## Авторизация

Все защищённые эндпоинты требуют заголовок:

    api-key: test

Любой ключ допустим, если он существует в базе пользователей.

Swagger уже настроен для работы с `api-key`.

------------------------------------------------------------------------

## Swagger-документация

Документация доступна сразу после запуска:

    http://localhost:8000/docs

------------------------------------------------------------------------

## Работа с изображениями

POST /api/medias → multipart/form-data\
Возвращает `media_id`, который используется при создании твита.

------------------------------------------------------------------------

## Тестирование

``` bash
pytest backend/tests
```

------------------------------------------------------------------------

## Структура проекта

```
.
├── backend/
│   ├── api/
│   ├── core/
│   ├── models/
│   ├── services/
│   ├── utils/
│   ├── requirements.txt
│   ├── Dockerfile
│   └── main.py
├── frontend/
│   ├── Dockerfile
│   └── dist/
├── uploads/
├── docker-compose.yml
└── requirements-dev.txt
```